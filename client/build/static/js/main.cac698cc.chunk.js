(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{119:function(e,t){},122:function(e,t,a){},123:function(e,t,a){},124:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),s=a(56),r=a.n(s),c=a(13),l=a(8),i=a(24),m=a(10),u=a(11),g=a(14),d=a(12),h=a(15),p=a(6),f=a.n(p),v=a(57),y=a.n(v),E=(a(84),a(7)),N=function(e){var t=e.room,a=t._id,n=t.name,s=t.user,r=t.color;return o.a.createElement(c.b,{to:{pathname:"/chat/".concat(a),state:{room:e.room}}},o.a.createElement("div",{className:"room"},o.a.createElement("div",{className:"avatar inline",style:{backgroundColor:r}}),o.a.createElement("h1",{className:"inline roomNameHeader"},n),y.a.isEqual(e.loggedUser,s)&&o.a.createElement("div",{className:"inline deleteBtn",onClick:e.deleteRoom},o.a.createElement(E.d,{className:"deleteIcon"}))))},U=(a(89),function(e){var t=e.openInput,a=e.cancelAddingRoom,s=e.roomName,r=e.addRoom,c=e.addRoomKeyPress,l=e.changeRoomName,i=e.addingRoom,m=o.a.createElement("div",{onClick:t,className:"addBtn"},"+"),u=o.a.createElement("div",{className:"addFormInput"},o.a.createElement("input",{placeholder:"Add a room...",className:"addInput",onChange:l,onKeyPress:c,value:s,type:"text",autoFocus:!0}),o.a.createElement("div",{className:"addButtons"},o.a.createElement("div",{className:"btnOk inline",onClick:r},o.a.createElement(E.a,null)),o.a.createElement("div",{className:"btnCancel inline",onClick:a},o.a.createElement(E.c,null)))),g=i?u:m;return o.a.createElement(n.Fragment,null,g)}),b=(a(90),window.location.hostname),R=window.location.protocol,k=null;k="localhost"===b?R+"//"+b+":8000":R+"//"+b;var S=function(e){function t(){var e,a;Object(m.a)(this,t);for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return(a=Object(g.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(o)))).state={loggedUser:{},roomName:"",addingRoom:!1,rooms:[]},a.getUser=function(e){f.a.get("".concat(k,"/getuser"),{headers:{Authorization:"Bearer ".concat(e)}}).then(function(e){e.data.expired?a.props.history.push("/login"):a.setState({loggedUser:e.data})}).catch(function(e){return a.props.history.push("/login")})},a.getRooms=function(){f.a.get(k).then(function(e){a.setState({rooms:e.data.rooms})})},a.addRoom=function(){var e="hsl("+360*Math.random()+","+(25+70*Math.random())+"%,"+(45+10*Math.random())+"%)",t={name:a.state.roomName,user:a.state.loggedUser,color:e,messages:[]};f.a.post("".concat(k,"/add"),t).then(function(e){a.setState({rooms:[].concat(Object(i.a)(a.state.rooms),[e.data.room]),addingRoom:!1,roomName:""})})},a.addRoomKeyPress=function(e){"Enter"===e.key&&a.addRoom()},a.cancelAddingRoom=function(){a.setState({addingRoom:!1,roomName:""})},a.openInput=function(){a.setState({addingRoom:!0})},a.onChangeRoomName=function(e){a.setState({roomName:e.target.value})},a.deleteRoom=function(e,t){t.preventDefault(),f.a.delete("".concat(k,"/").concat(e)).then(function(e){console.log(e),a.props.history.push("/")});var n=a.state.rooms.filter(function(t){return e!==t._id});a.setState({rooms:n})},a}return Object(h.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=localStorage.getItem("jwtToken");console.log(e),e?(this.getUser(e),this.getRooms()):this.props.history.push("/login")}},{key:"componentDidUpdate",value:function(){console.log(this.state)}},{key:"render",value:function(){var e=this,t=this.state.rooms.map(function(t,a){return o.a.createElement(N,{room:t,deleteRoom:function(a){return e.deleteRoom(t._id,a)},key:a,loggedUser:e.state.loggedUser})});return o.a.createElement("div",{className:"main"},o.a.createElement(n.Fragment,null,o.a.createElement("div",{className:"header"},o.a.createElement("p",{className:"welcome"},"Welcome ",this.state.loggedUser.username),o.a.createElement(c.b,{className:"changeProfile",to:"/login"},o.a.createElement("p",null,"Change profile"))),o.a.createElement("div",{className:"rooms"},t,o.a.createElement(U,{addingRoom:this.state.addingRoom,changeRoomName:this.onChangeRoomName,openInput:this.openInput,addRoom:this.addRoom,addRoomKeyPress:this.addRoomKeyPress,cancelAddingRoom:this.cancelAddingRoom,roomName:this.state.roomName}))))}}]),t}(n.Component),w=(a(91),window.location.hostname),C=window.location.protocol,j=null;j="localhost"===w?C+"//"+w+":8000":C+"//"+w;var I=function(e){function t(){var e,a;Object(m.a)(this,t);for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return(a=Object(g.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(o)))).state={username:""},a.loginUser=function(){var e={username:a.state.username};""!==a.state.username&&f.a.post("".concat(j,"/login"),e).then(function(e){var t=e.data.token;localStorage.setItem("jwtToken",t),a.props.history.push("/")}).catch(function(e){return a.props.history.push("/login")})},a.loginUserKeyPress=function(e){"Enter"===e.key&&a.loginUser()},a.onChangeLoggedUser=function(e){a.setState({username:e.target.value})},a}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{className:"login"},o.a.createElement("h1",null,"Login or register"),o.a.createElement("input",{className:"loginInput",type:"text",onChange:this.onChangeLoggedUser,onKeyPress:this.loginUserKeyPress,autoFocus:!0}),o.a.createElement("div",{className:"btnLogin",onClick:this.loginUser},o.a.createElement(E.a,null)))}}]),t}(n.Component),M=(a(92),function(e){var t=null,a=e.username,s=e.messages,r=e.typing;console.log(r);var c=s.map(function(e,t){return o.a.createElement(n.Fragment,{key:t},o.a.createElement("div",{className:"messageInfo ".concat(e.username===a?"user":"","\n      ")},o.a.createElement("p",null,e.username!==a&&e.username+","," ",e.date)),o.a.createElement("div",{className:"chatMessage ".concat(e.username===a?"user":"","\n      ")},o.a.createElement("div",{className:"chatBubble ".concat(e.username===a?"user":""," ").concat(e.message.length>35?"long":"","\n           ")},o.a.createElement("h2",null,e.message)),o.a.createElement("br",null)))});return r&&(t=r.map(function(e,t){return o.a.createElement("p",{className:"typing",key:t},e," is typing...")})),o.a.createElement("div",{id:"list",className:"chatMessages"},c,t||"")}),O=a(60),B=a.n(O),P=a(61),A=(a(122),window.location.hostname),T=window.location.protocol,K=null;K="localhost"===A?T+"//"+A+":8000":T+"//"+A,console.log(A,T,K);var x=B.a.connect(K),L=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(L,"px"));var D=function(e){function t(){var e,a;Object(m.a)(this,t);for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return(a=Object(g.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(o)))).state={room:{},loggedUser:{},users:[],message:"",typing:[],messages:[]},a.getUsersInRoom=function(){x.on("join",function(e){a.setState({users:e})})},a.getUsersLeavingRoom=function(){x.on("leave",function(e){a.setState({users:e})})},a.userIsTyping=function(){var e=a.state.typing.slice();x.on("user typing",function(t){a.state.loggedUser.username!==t&&(e.push(t),e=e.filter(function(e,t,a){return a.indexOf(e)===t}),console.log(e),a.setState({typing:e}))})},a.userNotTyping=function(){var e=a.state.typing.slice();x.on("user not typing",function(t){e.filter(function(e){return t===e}),a.setState({typing:e})})},a.socketSendMessage=function(e){var t={username:a.state.loggedUser.username,roomName:a.state.room.name};e.on("send message",function(n){e.emit("user not typing",t),a.setState({message:"",messages:[].concat(Object(i.a)(a.state.messages),[n])});var o=document.getElementById("list");o.scrollTop=o.scrollHeight})},a.getUser=function(e){f.a.get("".concat(K,"/getuser"),{headers:{Authorization:"Bearer ".concat(e)}}).then(function(e){a.setState({loggedUser:e.data});var t={user:a.state.loggedUser.username,room:a.state.room};x.emit("join",t)}).catch(function(e){return a.props.history.push("/login")})},a.getMessages=function(){f.a.get("".concat(K,"/chat/").concat(a.props.match.params.id)).then(function(e){a.setState({messages:e.data.messages});var t=document.getElementById("list");t.scrollTop=t.scrollHeight}).catch(function(e){return a.props.history.push("/")})},a.handleSendMessage=function(e){var t={username:a.state.loggedUser.username,message:e.target.value,date:(new Date).toLocaleString("en-GB"),room:a.state.room};"Enter"===e.key&&""!==a.state.message&&(x.emit("send message",t),a.setState({typing:""}))},a.handleClickSendMessage=function(){var e={username:a.state.loggedUser.username,message:a.state.message,date:(new Date).toLocaleString("en-GB"),room:a.state.room};""!==a.state.message&&(x.emit("send message",e),a.setState({typing:""}))},a.onChangeMessageInput=function(e){var t={username:a.state.loggedUser.username,roomName:a.state.room.name};a.setState({message:e.target.value},function(){""!==a.state.message?x.emit("user typing",t):x.emit("user not typing",t)})},a}return Object(h.a)(t,e),Object(u.a)(t,[{key:"componentDidUpdate",value:function(){console.log(this.state)}},{key:"componentDidMount",value:function(){var e=this,t=localStorage.getItem("jwtToken");console.log(this.props.match.params.id),t?this.setState({room:this.props.location.state.room},function(){e.getUser(t),e.userIsTyping(),e.userNotTyping(),e.socketSendMessage(x),e.getMessages(),e.getUsersInRoom(),e.getUsersLeavingRoom()}):this.props.history.push("/login")}},{key:"componentWillUnmount",value:function(){var e={user:this.state.loggedUser.username,room:this.state.room};x.emit("leave",e),this.setState({users:[]})}},{key:"render",value:function(){var e=this.state.room,t=e.color,a=e.name,n=this.state.users.map(function(e,t){return e+" "});return o.a.createElement("div",{className:"chat"},o.a.createElement("div",{className:"roomName"},o.a.createElement("div",{className:"avatar inline",style:{backgroundColor:t}}),o.a.createElement("h1",{className:"inline roomNameHeader"},a),o.a.createElement("p",{className:"connectedUsers"},n)),o.a.createElement(M,{messages:this.state.messages,username:this.state.loggedUser.username,typing:this.state.typing}),o.a.createElement("div",{className:"send"},o.a.createElement("input",{type:"text",className:"inputMessage",placeholder:"Type a message",onChange:this.onChangeMessageInput,onKeyPress:this.handleSendMessage,value:this.state.message}),P.isMobile&&o.a.createElement("div",{onClick:this.handleClickSendMessage,className:"sendButton"},o.a.createElement(E.b,null))))}}]),t}(n.Component),F=(a(123),o.a.createElement(c.a,null,o.a.createElement("div",null,o.a.createElement(l.d,null,o.a.createElement(l.b,{path:"/",exact:!0,component:S}),o.a.createElement(l.b,{path:"/login",component:I}),o.a.createElement(l.b,{path:"/chat/:id",component:D}),o.a.createElement(l.b,{render:function(){return o.a.createElement(l.a,{to:"/login"})}})))));r.a.render(F,document.getElementById("root"))},62:function(e,t,a){e.exports=a(124)},84:function(e,t,a){},89:function(e,t,a){},90:function(e,t,a){},91:function(e,t,a){},92:function(e,t,a){}},[[62,1,2]]]);
//# sourceMappingURL=main.cac698cc.chunk.js.map